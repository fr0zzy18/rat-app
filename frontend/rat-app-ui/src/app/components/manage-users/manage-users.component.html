<div class="manage-users-container">
  <h2>Manage Users</h2>

  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>

  <table class="users-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Username</th>
        <th>Roles</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users">
        <td>{{ user.id }}</td>
        <td>{{ user.username }}</td>
        <td>{{ user.roles?.join(', ') }}</td>
        <td>
          <button (click)="editUser(user)" class="btn btn-edit">Edit</button>
          <button (click)="openChangePasswordModal(user.id)" class="btn btn-change-password">Change Password</button>
          <button (click)="deleteUser(user.id, user.username)" class="btn btn-delete">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="editingUser" class="edit-user-form">
    <h3>Edit User: {{ editingUser.username }}</h3>
    <form [formGroup]="editUserForm" (ngSubmit)="saveUser()">
      <div class="form-group">
        <label for="editUsername">Username</label>
        <input type="text" id="editUsername" formControlName="username" class="form-control">
      </div>
      <div class="form-group">
        <label for="editRole">Role</label>
        <select id="editRole" formControlName="roleName" class="form-control">
          <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
        </select>
      </div>
      <button type="submit" [disabled]="editUserForm.invalid" class="btn btn-primary">Save</button>
      <button type="button" (click)="cancelEdit()" class="btn btn-secondary">Cancel</button>
    </form>
  </div>
</div>

<app-change-password-modal
  *ngIf="showChangePasswordModal"
  [userId]="selectedUserIdForPasswordChange!"
  (closeModal)="closeChangePasswordModal()"
  (passwordChanged)="onPasswordChanged()"
></app-change-password-modal>
